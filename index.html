<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Index Hub - Data Intelligence Center</title>
  <style>
    /* Your existing CSS styles remain unchanged */
  </style>
</head>
<body>

  <!-- Invisible anchor for "Top" -->
  <div id="top"></div>

  <!-- NAVBAR -->
  <div class="navbar">
    <a href="#top" class="navbar-title">Index Hub</a>
    <div class="navbar-links">
      <a href="#all">All</a>
      <a href="#brandrank">BrandRank</a>
      <a href="#industry">Industry</a>
      <a href="#dashboards">Dashboards</a>
      <a href="#research">Research</a>
      <a href="#uploads">Uploads</a>
    </div>
  </div>

  <script>
    // Smooth scrolling
    document.querySelectorAll('.navbar-links a').forEach(link => {
      link.addEventListener('click', e => {
        e.preventDefault();
        const target = document.querySelector(link.getAttribute('href'));
        if (target) target.scrollIntoView({ behavior: 'smooth', block: 'start' });
      });
    });
  </script>

  <div class="hero">
    <h1 class="hero-title">Index Hub</h1>
    <p class="hero-subtitle">Data Intelligence & Analytics Center</p>
    <p class="hero-description">
      Explore comprehensive datasets, market analysis, and intelligence reports across multiple industries and categories.
    </p>
  </div>

  <!-- ===== Uploads (control panel at top) ===== -->
  <div class="container" id="uploads" style="padding-top:30px;">
    <h3 class="subsection-title">Uploads</h3>
    <div class="index-card" style="margin-bottom:24px;">
      <div class="index-card-icon">üóÇÔ∏è</div>
      <h3 class="index-card-title" style="margin-bottom:8px;">Add a File</h3>
      <p class="index-card-description" style="margin-bottom:16px;">
        Choose a section, pick an icon, and upload any type of file. It will appear as a card at the top of that section.
      </p>
      <div style="display:flex; gap:12px; flex-wrap:wrap; align-items:center;">
        <input id="uploadTitle" class="input" type="text" placeholder="Optional title (defaults to file name)"/>
        <input id="uploadIcon" class="input" type="text" placeholder="Icon (e.g., üß©)" style="width:120px"/>
        <select id="uploadSection" class="input select" aria-label="Section">
          <option value="brandrank">BrandRank</option>
          <option value="industry">Industry</option>
          <option value="dashboards">Dashboards</option>
          <option value="research" selected>Research</option>
        </select>
        <!-- Accept all file types now -->
        <input id="uploadFile" class="input" type="file" accept="*/*"/>
        <button id="uploadBtn" class="btn">Add to Page</button>
      </div>
      <p style="color:#707070; font-size:.85rem; margin-top:10px;">
        Note: If your GitHub configuration is valid, uploads are pushed to your repo and given a shareable URL. Otherwise, they are stored locally in this browser only.
      </p>
    </div>
  </div>

  <!-- JavaScript Logic to Handle Uploads -->
  <script>
    const uploadBtnEl = document.getElementById('uploadBtn');
    const uploadFileEl = document.getElementById('uploadFile');
    const uploadTitleEl = document.getElementById('uploadTitle');
    const uploadIconEl = document.getElementById('uploadIcon');
    const uploadSectionEl = document.getElementById('uploadSection');

    uploadBtnEl.addEventListener('click', async () => {
      const file = uploadFileEl.files[0];

      if (!file) {
        alert('Please choose a file to upload.');
        return;
      }

      const reader = new FileReader();
      reader.onload = async (e) => {
        const contentText = e.target.result;
        const title = uploadTitleEl.value || file.name.replace(/\.[^/.]+$/, '');
        const icon = uploadIconEl.value || 'üìÑ';  // Default icon
        const section = uploadSectionEl.value;

        let url = null;

        // Handle the file upload to GitHub (if configured)
        try {
          url = await uploadToGitHub({
            fileName: file.name,
            html: contentText
          });
        } catch (err) {
          console.error('Error uploading to GitHub:', err);
          alert('Error uploading to GitHub. File will be saved locally.');
        }

        // Store the uploaded file's details
        const uploadData = {
          id: Date.now() + '_' + Math.random().toString(36).slice(2),
          title,
          icon,
          section,
          dateISO: new Date().toISOString(),
          contentText,
          url  // GitHub URL or null
        };

        saveUpload(uploadData);  // Save the upload to local storage or GitHub
        displayUploads();  // Refresh the list of uploads
      };
      reader.readAsText(file);  // Read the file content
    });

    // Helper functions to manage uploads
    function saveUpload(uploadData) {
      const uploads = getUploads();
      uploads.unshift(uploadData);  // Add the new upload to the front of the array
      localStorage.setItem('uploads', JSON.stringify(uploads));
    }

    function getUploads() {
      const uploads = localStorage.getItem('uploads');
      return uploads ? JSON.parse(uploads) : [];
    }

    function displayUploads() {
      const uploads = getUploads();
      const uploadsGrid = document.getElementById('uploads');
      uploadsGrid.innerHTML = '';  // Clear previous uploads

      uploads.forEach(upload => {
        const card = document.createElement('div');
        card.classList.add('index-card');
        card.innerHTML = `
          <div class="index-card-icon">${upload.icon}</div>
          <h3 class="index-card-title">${upload.title}</h3>
          <p class="index-card-description">${upload.url ? 'Uploaded to GitHub' : 'Stored locally'}</p>
          <div class="index-card-meta">
            <span class="index-card-date">${new Date(upload.dateISO).toLocaleDateString()}</span>
          </div>
        `;

        uploadsGrid.appendChild(card);  // Append the new card
      });
    }

    // Call this on initial page load to display existing uploads
    displayUploads();
  </script>

  <!-- Additional content if necessary -->

</body>
</html>
