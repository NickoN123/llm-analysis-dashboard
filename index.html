<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Index Hub - Data Intelligence Center</title>
  <style>
    /* CSS remains the same as the previous design */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #0a0e1a;
      color: #e0e0e0;
      line-height: 1.6;
    }

    /* NAVBAR */
    .navbar {
      background-color: #0d1220;
      border-bottom: 1px solid #00d4ff;
      padding: 15px 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky; top: 0; z-index: 1000;
    }
    .navbar-title { color: #00d4ff; font-weight: 700; font-size: 1.3rem; text-decoration: none; }
    .navbar-links a {
      color: #e0e0e0; margin-left: 20px; text-decoration: none; font-size: 1rem; transition: color .2s ease;
    }
    .navbar-links a:hover { color: #00d4ff; }

    /* Hero Section */
    .hero {
      background: linear-gradient(135deg, #0a0e1a 0%, #141822 100%);
      padding: 80px 20px; text-align: center; border-bottom: 3px solid #00d4ff;
    }
    .hero-title {
      font-size: 3.5rem; font-weight: 700; color: #00d4ff; margin-bottom: 20px;
      text-shadow: 0 0 20px rgba(0,212,255,.3);
    }
    .hero-subtitle { font-size: 1.3rem; color: #b0b0b0; font-weight: 300; max-width: 700px; margin: 0 auto 40px; }
    .hero-description { font-size: 1rem; color: #909090; max-width: 600px; margin: 0 auto; line-height: 1.8; }

    .container { max-width: 1400px; margin: 0 auto; padding: 60px 20px; }
    .section-title { font-size: 2rem; color: #00d4ff; margin-bottom: 20px; text-align: center; font-weight: 600; }

    /* Upload UI */
    .btn {
      display:inline-block; padding:10px 16px; border:1px solid #00d4ff;
      border-radius:10px; color:#00d4ff; background:transparent; cursor:pointer;
      font-weight:600; transition:all .2s ease; text-decoration:none;
    }
    .btn:hover { background:#001b22; box-shadow:0 6px 16px rgba(0,212,255,.2);}
    .input {
      background:#0f1422; border:1px solid #1a2030; color:#e0e0e0;
      padding:10px 12px; border-radius:10px;
    }
    .select { appearance:none; }
    .del-pill {
      background:#1a2030; color:#ff6b6b; border:1px solid #2a2a2a;
      padding:4px 8px; border-radius:999px; font-size:.75rem; cursor:pointer;
    }

    .footer { text-align: center; padding: 40px 20px; color: #707070; border-top: 1px solid #1a2030; margin-top: 60px; }
    .footer a { color: #00d4ff; text-decoration: none; }
    .footer a:hover { text-decoration: underline; }

    @media (max-width: 768px) {
      .hero-title { font-size: 2.5rem; }
      .hero-subtitle { font-size: 1.1rem; }
      .index-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

  <!-- Invisible anchor for "Top" -->
  <div id="top"></div>

  <!-- NAVBAR -->
  <div class="navbar">
    <a href="#top" class="navbar-title">Index Hub</a>
    <div class="navbar-links">
      <a href="#all">All</a>
      <a href="#brandrank">BrandRank</a>
      <a href="#industry">Industry</a>
      <a href="#dashboards">Dashboards</a>
      <a href="#research">Research</a>
      <a href="#uploads">Uploads</a>
    </div>
  </div>

  <div class="hero">
    <h1 class="hero-title">Index Hub</h1>
    <p class="hero-subtitle">Data Intelligence & Analytics Center</p>
    <p class="hero-description">
      Explore comprehensive datasets, market analysis, and intelligence reports across multiple industries and categories.
    </p>
  </div>

  <!-- ===== Uploads Section ===== -->
  <div class="container" id="uploads" style="padding-top:30px;">
    <h3 class="subsection-title">Uploads</h3>
    <div class="index-card" style="margin-bottom:24px;">
      <div class="index-card-icon">üóÇÔ∏è</div>
      <h3 class="index-card-title" style="margin-bottom:8px;">Upload a File</h3>
      <p class="index-card-description" style="margin-bottom:16px;">
        Choose a section, pick an icon, and upload any file (e.g., audio, PDF, HTML, images). It will appear as a card at the top of that section. If your upload API is configured, it will also generate a hosted link you can share.
      </p>
      <div style="display:flex; gap:12px; flex-wrap:wrap; align-items:center;">
        <input id="uploadTitle" class="input" type="text" placeholder="Optional title (defaults to file name)"/>
        <input id="uploadIcon" class="input" type="text" placeholder="Icon (e.g., üéß)" style="width:120px"/>
        <select id="uploadSection" class="input select" aria-label="Section">
          <option value="brandrank">BrandRank</option>
          <option value="industry">Industry</option>
          <option value="dashboards">Dashboards</option>
          <option value="research" selected>Research</option>
        </select>
        <input id="uploadFile" class="input" type="file" />
        <button id="uploadBtn" class="btn">Add to Page</button>
      </div>
      <p style="color:#707070; font-size:.85rem; margin-top:10px;">
        Note: if the upload endpoint succeeds, uploads are hosted and get a shareable URL. Otherwise, they are stored locally in this browser only.
      </p>
    </div>
  </div>

  <!-- All -->
  <div class="container" id="all">
    <h2 class="section-title">Available Indexes</h2>
    <!-- Your other sections go here... -->
  </div>

  <div class="footer">
    <p>&copy; 2025 Index Hub. Built with data intelligence in mind.</p>
    <p><a href="https://github.com/NickoN123/llm-analysis-dashboard">GitHub</a></p>
  </div>

  <!-- Uploads logic -->
  <script>
    (function() {
      'use strict';

      const UPLOAD_ENDPOINT = 'https://llm-analysis-dashboard.vercel.app/api/upload';

      async function uploadToServer({ fileName, contentBase64 }) {
        const res = await fetch(UPLOAD_ENDPOINT, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ fileName, contentBase64 })
        });

        if (!res.ok) {
          const text = await res.text().catch(() => '');
          throw new Error('Upload failed: ' + res.status + ' ' + text);
        }

        const data = await res.json();
        if (!data.url) {
          throw new Error('Upload response did not include a URL');
        }
        return data.url;
      }

      const STORAGE_KEY = 'ihUploads';
      const SECTION_IDS = {
        brandrank: 'brandrankGrid',
        industry: 'industryGrid',
        dashboards: 'dashboardsGrid',
        research: 'researchGrid'
      };

      function getUploads() {
        try { return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }
        catch { return []; }
      }
      function setUploads(arr) { localStorage.setItem(STORAGE_KEY, JSON.stringify(arr)); }

      function openUpload(u) {
        const w = window.open('', '_blank');
        if (!w) { alert('Popup blocked. Please allow popups for this site.'); return; }
        const title = u.title || 'Uploaded File';
        w.document.open();
        w.document.write(u.contentText || '<!DOCTYPE html><html><body><p>No content stored.</p></body></html>');
        try { w.document.title = title; } catch {}
        w.document.close();
      }

      function deleteUpload(id) {
        const next = getUploads().filter(x => x.id !== id);
        setUploads(next);
        renderAll();
      }

      function buildCard(u) {
        const a = document.createElement('a');
        a.className = 'index-card-link';
        a.setAttribute('data-upload', '1');
        a.setAttribute('data-upload-id', u.id);

        if (u.url) {
          a.href = u.url;
          a.target = '_blank';
          a.rel = 'noopener noreferrer';
        } else {
          a.href = '#';
          a.addEventListener('click', (e) => {
            e.preventDefault();
            openUpload(u);
          });
        }

        const card = document.createElement('div');
        card.className = 'index-card';

        const icon = document.createElement('div');
        icon.className = 'index-card-icon';
        icon.textContent = u.icon || 'üß©';

        const title = document.createElement('h3');
        title.className = 'index-card-title';
        title.textContent = u.title || 'Uploaded File';

        const desc = document.createElement('p');
        desc.className = 'index-card-description';
        desc.textContent = u.url
          ? 'User-uploaded file with a shareable link. Click to open or copy link.'
          : 'User-uploaded HTML stored locally in your browser.';

        const meta = document.createElement('div');
        meta.className = 'index-card-meta';

        const dateSpan = document.createElement('span');
        dateSpan.className = 'index-card-date';
        const niceDate = new Date(u.dateISO).toLocaleDateString(undefined, {
          year: 'numeric',
          month: 'short',
          day: 'numeric'
        });
        dateSpan.textContent = niceDate;

        const right = document.createElement('span');
        right.style.display = 'flex';
        right.style.gap = '8px';
        right.style.alignItems = 'center';

        const badge = document.createElement('span');
        badge.className = 'index-card-badge';
        badge.textContent = u.url ? 'Hosted' : 'Uploaded';

        if (u.url) {
          const copyBtn = document.createElement('button');
          copyBtn.className = 'del-pill';
          copyBtn.type = 'button';
          copyBtn.textContent = 'Copy link';
          copyBtn.style.color = '#00d4ff';
          copyBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            e.preventDefault();
            navigator.clipboard.writeText(u.url)
              .then(() => alert('Link copied to clipboard.'))
              .catch(() => alert('Could not copy link.'));
          });
          right.appendChild(copyBtn);
        }

        const del = document.createElement('button');
        del.className = 'del-pill';
        del.type = 'button';
        del.textContent = 'Delete';
        del.title = 'Remove from this browser';
        del.addEventListener('click', (e) => {
          e.stopPropagation(); e.preventDefault();
          if (confirm('Delete this uploaded file from your browser?')) {
            deleteUpload(u.id);
          }
        });

        right.appendChild(badge);
        right.appendChild(del);

        meta.appendChild(dateSpan);
        meta.appendChild(right);

        card.appendChild(icon);
        card.appendChild(title);
        card.appendChild(desc);
        card.appendChild(meta);
        a.appendChild(card);
        return a;
      }

      function renderAll() {
        Object.values(SECTION_IDS).forEach(gridId => {
          const grid = document.getElementById(gridId);
          if (!grid) return;
          grid.querySelectorAll('[data-upload="1"]').forEach(node => node.remove());
        });

        const uploads = getUploads();
        uploads.sort((a,b) => new Date(b.dateISO) - new Date(a.dateISO));

        uploads.forEach(u => {
          const gridId = SECTION_IDS[u.section] || SECTION_IDS.research;
          const grid = document.getElementById(gridId);
          if (!grid) return;
          const card = buildCard(u);
          if (grid.firstChild) grid.insertBefore(card, grid.firstChild);
          else grid.appendChild(card);
        });
      }

      document.addEventListener('DOMContentLoaded', () => {
        const uploadTitleEl   = document.getElementById('uploadTitle');
        const uploadIconEl    = document.getElementById('uploadIcon');
        const uploadSectionEl = document.getElementById('uploadSection');
        const uploadFileEl    = document.getElementById('uploadFile');
        const uploadBtnEl     = document.getElementById('uploadBtn');

        if (!uploadBtnEl) {
          console.error('Upload button not found in DOM.');
          return;
        }

        uploadBtnEl.addEventListener('click', () => {
          const file = uploadFileEl.files && uploadFileEl.files[0];
          if (!file) { alert('Choose a file first.'); return; }

          const reader = new FileReader();

          // Use Data URL to easily extract base64 for ANY file type
          reader.onload = async (e) => {
            const dataUrl = e.target.result; // e.g. "data:audio/mpeg;base64,AAAA..."
            const base64 = String(dataUrl).split(',')[1]; // strip "data:*/*;base64,"

            const title = (uploadTitleEl.value || file.name.replace(/\.[^/.]+$/, '')).trim();
            const icon  = (uploadIconEl.value || '').trim() || 'üß©';
            const section = uploadSectionEl.value || 'research';

            let url = null;
            try {
              url = await uploadToServer({
                fileName: file.name,
                contentBase64: base64
              });
            } catch (err) {
              console.error('Upload to server failed:', err);
              alert('Could not upload to GitHub. This will be stored locally only (HTML files only).');
            }

            const item = {
              id: 'u_' + Date.now() + '_' + Math.random().toString(36).slice(2, 8),
              title,
              icon,
              section,
              dateISO: new Date().toISOString(),
              // Only meaningful for local HTML fallback; for binary this will usually be null
              contentText: null,
              url
            };

            const uploads = getUploads();
            uploads.unshift(item);
            setUploads(uploads);

            uploadTitleEl.value = '';
            uploadIconEl.value  = '';
            uploadFileEl.value  = '';
            renderAll();

            const anchor = document.getElementById(section);
            if (anchor) anchor.scrollIntoView({ behavior: 'smooth', block: 'start' });
          };

          reader.readAsDataURL(file);
        });

        renderAll();
      });
    })();
  </script>
</body>
</html>
